<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Gizi Anak</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <style>
    body { background-color:#fff8f0; font-family:Arial; }
    .form-section { background:#ffe5b4; padding:20px; border-radius:10px; }
    .result-section { background:#a9db37; padding:20px; margin-top:20px; border-radius:10px; }
    .chart-container { margin-top:20px; background:#fff; padding:15px; border-radius:10px; }
    .btn-orange { background:#ff7f00; color:#fff; }
  </style>
</head>
<body class="container py-5">
  <h1 class="text-center mb-4 text-warning">Kalkulator Status Gizi Anak</h1>

  <div class="form-section">
    <form id="formGizi">
      <div class="row g-3">
        <div class="col-md-6">
          <label>Nama Anak</label>
          <input type="text" id="nama" class="form-control" required>
        </div>
        <div class="col-md-6">
          <label>Usia (bulan)</label>
          <input type="number" id="usia" class="form-control" required>
        </div>
        <div class="col-md-6">
          <label>Jenis Kelamin</label>
          <select id="jenisKelamin" class="form-control">
            <option value="laki-laki">Laki-laki</option>
            <option value="perempuan">Perempuan</option>
          </select>
        </div>
        <div class="col-md-6">
          <label>Berat Badan (kg)</label>
          <input type="number" step="0.1" id="bb" class="form-control" required>
        </div>
        <div class="col-md-6">
          <label>Tinggi Badan (cm)</label>
          <input type="number" step="0.1" id="tb" class="form-control" required>
        </div>
        <div class="col-md-12 text-center">
          <button type="submit" class="btn btn-orange mt-3">Hitung Status Gizi</button>
        </div>
      </div>
    </form>
  </div>

  <div id="output" style="display:none;">

    <div class="text-center mb-3">
      <strong>Tanggal Cetak:</strong> <span id="tanggalCetak"></span><br>
      <strong>Nama Anak:</strong> <span id="namaCetak"></span>
    </div>

    <div class="chart-container">
      <h5 class="text-center">Grafik Tinggi dan Berat Ideal</h5>
      <canvas id="chartIdeal"></canvas>
    </div>

    <div class="chart-container">
      <h5 class="text-center">Berat Badan Menurut Umur</h5>
      <canvas id="chartBBU"></canvas>
    </div>
    <div class="result-section" id="hasilBBU"></div>

    <div class="chart-container">
      <h5 class="text-center">Tinggi Badan Menurut Umur</h5>
      <canvas id="chartTBU"></canvas>
    </div>
    <div class="result-section" id="hasilTBU"></div>

    <div class="chart-container">
      <h5 class="text-center">Berat Badan Menurut Tinggi Badan</h5>
      <canvas id="chartBBTB"></canvas>
    </div>
    <div class="result-section" id="hasilBBTB"></div>

    <div class="text-center mt-4">
      <button onclick="unduhPDF()" class="btn btn-success">Unduh Hasil sebagai PDF</button>
    </div>
  </div>

<script>
/* ===================== DATA ===================== */
const dataBBU = [
  { usia:0, median:3.3, minus2SD:2.5, plus1SD:3.9 },
  { usia:1, median:4.5, minus2SD:3.4, plus1SD:5.1 },
  { usia:2, median:5.6, minus2SD:4.3, plus1SD:6.3 },
  { usia:3, median:6.4, minus2SD:5.0, plus1SD:7.2 },
  { usia:4, median:7.0, minus2SD:5.6, plus1SD:7.8 },
  { usia:5, median:7.5, minus2SD:6.0, plus1SD:8.4 },
  { usia:6, median:7.9, minus2SD:6.4, plus1SD:8.8 },
  { usia:7, median:8.3, minus2SD:6.7, plus1SD:9.2 },
  { usia:8, median:8.6, minus2SD:6.9, plus1SD:9.6 },
  { usia:9, median:8.9, minus2SD:7.1, plus1SD:9.9 },
  { usia:10, median:9.2, minus2SD:7.4, plus1SD:10.2 }
];

const dataTBU = [
  { usia:0, median:49.9, minus2SD:46.1, plus1SD:53.7 },
  { usia:1, median:54.7, minus2SD:50.8, plus1SD:58.6 },
  { usia:2, median:58.4, minus2SD:54.4, plus1SD:62.4 },
  { usia:3, median:61.4, minus2SD:57.3, plus1SD:65.5 },
  { usia:4, median:63.9, minus2SD:59.6, plus1SD:68.0 },
  { usia:5, median:65.9, minus2SD:61.5, plus1SD:70.1 },
  { usia:6, median:67.6, minus2SD:63.1, plus1SD:71.9 },
  { usia:7, median:69.2, minus2SD:64.6, plus1SD:73.5 },
  { usia:8, median:70.6, minus2SD:66.0, plus1SD:75.0 },
  { usia:9, median:72.0, minus2SD:67.3, plus1SD:76.4 },
  { usia:10, median:73.3, minus2SD:68.6, plus1SD:77.7 }
];

/* BB/TB data truncated here for brevity but should be included fully */
const dataBBTB_L = [
  { tb:65, median:7.0, minus2SD:5.7, plus1SD:8.0 },
  { tb:66, median:7.2, minus2SD:5.8, plus1SD:8.2 },
  { tb:67, median:7.4, minus2SD:6.0, plus1SD:8.4 }
];
const dataBBTB_P = dataBBTB_L.map(r=>({tb:r.tb, median:r.median-0.2, minus2SD:r.minus2SD-0.2, plus1SD:r.plus1SD-0.2}));

/* ============= STATUS FUNCTIONS ============= */
function getStatus(value, ref) {
  const sdGap = ref.median - ref.minus2SD;
  if (value < ref.minus2SD - sdGap) return {status:"Sangat Rendah", saran:"Intervensi gizi"};
  if (value < ref.minus2SD) return {status:"Rendah", saran:"Perbaiki gizi"};
  if (value <= ref.plus1SD) return {status:"Normal", saran:"Pertahankan"};
  return {status:"Tinggi", saran:"Pantau rutin"};
}

function getStatusBBTB(bb, tb, jk){
  const data = jk==="perempuan" ? dataBBTB_P : dataBBTB_L;
  const nearest = data.reduce((p,c)=>Math.abs(c.tb-tb)<Math.abs(p.tb-tb)?c:p);
  const sdGap = nearest.median - nearest.minus2SD;
  if (bb < nearest.minus2SD - sdGap) return {status:"Gizi Buruk", saran:"Intervensi segera"};
  if (bb < nearest.minus2SD) return {status:"Gizi Kurang", saran:"Perbaiki pola makan"};
  if (bb <= nearest.plus1SD) return {status:"Normal", saran:"Pertahankan"};
  return {status:"Risiko Gizi Lebih", saran:"Pantau makan"};
}

/* ============= GRAPH RENDERER ============= */
function renderChart(canvasId, usia, value){
  const ref = canvasId==="chartBBU" ? dataBBU : dataTBU;
  new Chart(document.getElementById(canvasId),{
    type:"line",
    data:{
      labels:ref.map(r=>r.usia),
      datasets:[
        {label:"-2 SD", data:ref.map(r=>r.minus2SD), borderColor:"red"},
        {label:"Median", data:ref.map(r=>r.median), borderColor:"green"},
        {label:"+1 SD", data:ref.map(r=>r.plus1SD), borderColor:"orange"},
        {
          label:"Anak", data:ref.map(r=>r.usia===usia?value:null),
          borderColor:"blue", backgroundColor:"blue", pointRadius:5, showLine:false
        }
      ]
    }
  });
}

function renderChartBBTB(tb, bb, jk){
  const data = jk==="perempuan"?dataBBTB_P:dataBBTB_L;
  new Chart(document.getElementById("chartBBTB"),{
    type:"line",
    data:{
      labels:data.map(r=>r.tb),
      datasets:[
        {label:"-2 SD", data:data.map(r=>r.minus2SD), borderColor:"red"},
        {label:"Median", data:data.map(r=>r.median), borderColor:"green"},
        {label:"+1 SD", data:data.map(r=>r.plus1SD), borderColor:"orange"},
        {
          label:"Anak", data:data.map(r=>r.tb===tb?bb:null),
          borderColor:"blue", backgroundColor:"blue", pointRadius:5, showLine:false
        }
      ]
    }
  });
}

function renderIdealChart(tb, bb, jk){ renderChartBBTB(tb,bb,jk);} /* reuse */

/* ============= FORM SUBMIT ============= */
document.getElementById("formGizi").addEventListener("submit", function(e){
  e.preventDefault();
  const usia = parseInt(document.getElementById("usia").value);
  if(usia<0||usia>60){ alert("Usia harus 0â€“60 bulan"); return; }

  const nama = document.getElementById("nama").value;
  const jk = document.getElementById("jenisKelamin").value;
  const bb = parseFloat(document.getElementById("bb").value);
  const tb = parseFloat(document.getElementById("tb").value);

  document.getElementById("namaCetak").innerText = nama;
  document.getElementById("tanggalCetak").innerText = new Date().toLocaleDateString("id-ID");

  document.getElementById("hasilBBU").innerHTML = `Status BB/U: ${getStatus(bb,dataBBU.find(r=>r.usia===usia)).status}`;
  document.getElementById("hasilTBU").innerHTML = `Status TB/U: ${getStatus(tb,dataTBU.find(r=>r.usia===usia)).status}`;
  document.getElementById("hasilBBTB").innerHTML = `Status BB/TB: ${getStatusBBTB(bb,tb,jk).status}`;

  renderChart("chartBBU",usia,bb);
  renderChart("chartTBU",usia,tb);
  renderChartBBTB(tb,bb,jk);
  renderIdealChart(tb,bb,jk);

  document.getElementById("output").style.display="block";
});

function unduhPDF(){
  const element=document.getElementById("output");
  html2pdf().from(element).save("hasil-status-gizi.pdf");
}
</script>
</body>
</html>
